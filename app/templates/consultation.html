{% extends "base.html" %}
{% block content %}

<title>Booking Page</title>
<style>
  .form-container {
    margin-top: 20px;
    display: none;
  }

  input, select, textarea, .book-btn {
    padding: 8px;
    width: 100%;
    max-width: 400px;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<h1>Book Your Appointment</h1>


<label for="booking-type">Choose Booking Type:</label>
<select id="booking-type">
  <option value="">-- Select --</option>
  <option value="consultation">Consultation</option>
  <option value="installation">Installation</option>
</select>

<!-- ================= CONSULTATION FORM ================= -->
<div id="consultation-form" class="form-container">
  <h2>Consultation Booking</h2>

  <form method="POST">
    {{ form.hidden_tag() }}

    <label for="name">Name:</label>
    {{ form.name(
        id="consult-name",
        placeholder="Your full name"
    ) }}

    <label for="email">Email:</label>
    {{ form.email(
        id="consult-email",
        placeholder="you@example.com"
    ) }}

    <label for="date">Preferred Date:</label>
    {{ form.date(id="consult-date") }}

    <label for="time">Preferred Time:</label>
    {{ form.time(id="consult-time") }}

    <label for="notes">Additional Notes:</label>
    {{ form.notes(rows=3) }}

    <button type="submit" class="book-btn">Book Consultation</button>
  </form>
</div>

<!-- ================= INSTALLATION FORM (OPTIONAL) ================= -->
<div id="installation-form" class="form-container">
  <h2>Installation Booking</h2>

  <form method="POST">
    {{ form.hidden_tag() }}

    <label for="name">Name:</label>
    {{ form.name(
        id="install-name"
    ) }}

    <label for="email">Email:</label>
    {{ form.email(
        id="install-email"
    ) }}

    <label for="notes">Installation Address / Details:</label>
    {{ form.notes(rows=4) }}

    <label for="date">Preferred Date:</label>
    {{ form.date(id="install-date") }}

    <label for="time">Preferred Time:</label>
    {{ form.time(id="install-time") }}

    <button type="submit" class="book-btn">Book Installation</button>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const bookingType = document.getElementById('booking-type');
  const consultationForm = document.getElementById('consultation-form');
  const installationForm = document.getElementById('installation-form');

  bookingType.addEventListener('change', () => {
    const type = bookingType.value;
    consultationForm.style.display = type === 'consultation' ? 'block' : 'none';
    installationForm.style.display = type === 'installation' ? 'block' : 'none';
  });

  function validateTime(input) {
    const timeValue = input.value;
    if (!timeValue) return;

    const [hours, minutes] = timeValue.split(':').map(Number);

    if (minutes % 30 !== 0) {
      const correctedMinutes = minutes < 15 ? 0 : minutes < 45 ? 30 : 0;
      const correctedHours = correctedMinutes === 0 && minutes > 45 ? hours + 1 : hours;

      const newTime =
        String(correctedHours).padStart(2, '0') +
        ':' +
        String(correctedMinutes).padStart(2, '0');

      alert(`Invalid time! Adjusted to nearest 30-minute interval: ${newTime}`);
      input.value = newTime;
    }
  }

  const consultTime = document.getElementById('consult-time');
  const installTime = document.getElementById('install-time');

  if (consultTime) {
    consultTime.addEventListener('change', () => validateTime(consultTime));
  }

  if (installTime) {
    installTime.addEventListener('change', () => validateTime(installTime));
  }
});
</script>

{% endblock %}