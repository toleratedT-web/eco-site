{% extends "base.html" %}
{% block title %}Carbon Footprint Dashboard{% endblock %}
{% block content %}

<div class="card shadow-sm mb-4">
  <div class="col-md-4">
    <div class="card text-bg-success mb-3">
    <div class="card-body">
        <h5 class="card-title">Total Footprint</h5>
        <p id="totalFootprintsValue" class="card-text fs-3">
        
        </p>
    </div>
    </div>
  </div>

  <div class="card-header bg-light">
    <strong>All Carbon Footprints</strong>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover mb-0 align-middle">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Car Emission</th>
          <th>Electricity Emission</th>
          <th>Total Footprint</th>
          <th>Delete</th>
        </tr>
      </thead>
        <tbody>
            {% for footprint in footprints %}
                <tr>
                    <td>{{ footprint.id }}</td>
                    <td>{{ footprint.name }}</td>
                    <td>{{ footprint.car_emission }} kg CO₂e</td>
                    <td>{{ footprint.electricity_usage }} kg CO₂e</td>
                    <td>{{ footprint.total_footprint }} kg CO₂e</td>
                    <td>
                        <form method="post" action="{{ url_for('main.delete', id=footprint.id) }}" novalidate>
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>


  <div class="row mb-4">
    <div class="col-md-4">
        <div class="card mt-2">
            <div class="card-header">
            Top 5 Total Footprints
            </div>
            <div class="card-body">
            <canvas id="footprintsChart" height="170"></canvas>
            </div>
        </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
  <script>
    fetch("{{ url_for('main.top_five_footprints') }}")
      .then(response => response.json())
      .then(data => {
        const labels = data.map(item => item.name);
        const values = data.map(item => item.total);

        const ctx = document.getElementById('footprintsChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Total Footprint per person',
              data: values,
              backgroundColor: 'rgba(54, 162, 235, 0.6)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, title: { display: true, text: 'kg CO₂e' } } }
          }
        });
      });

    fetch("{{ url_for('main.total_footprints') }}")
      .then(response => response.json())
      .then(data => {
        const element = document.getElementById('totalFootprintsValue');
        element.innerText = data.total_footprints;
      });
  </script>
{% endblock %}