{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<h1 class="mb-4">Account Settings</h1>

<div class="settings-layout">
  <nav class="settings-sidebar" aria-label="Settings navigation">
    <ul>
      <li><a href="#profile" class="active">Profile</a></li>
      <li><a href="#password">Change Password</a></li>
      <li><a href="#support">Contact Support</a></li>
      <li><a href="#bookings">Bookings</a></li>
      <li><a href="#account">Account</a></li>
      <li><a href="#security">Security</a></li>
    </ul>
  </nav>

  <div class="settings-content">
    <section id="profile" class="settings-section">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Profile</h5>
          <form method="post">
            {{ settings_form.hidden_tag() }}
            <div class="mb-3">
              {{ settings_form.name.label(class='form-label') }}
              {{ settings_form.name(class='form-control') }}
            </div>
            <div class="mb-3">
              {{ settings_form.email.label(class='form-label') }}
              {{ settings_form.email(class='form-control') }}
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-primary" type="submit">Save</button>
              <a href="{{ url_for('main.settings') }}" class="btn btn-outline-secondary">Reset</a>
            </div>
          </form>
        </div>
      </div>
    </section>

    <section id="password" class="settings-section">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Change Password</h5>
          <form method="post">
            {{ pwd_form.hidden_tag() }}
            <div class="mb-2">{{ pwd_form.current_password.label(class='form-label') }}{{ pwd_form.current_password(class='form-control') }}</div>
            <div class="mb-2">{{ pwd_form.password.label(class='form-label') }}{{ pwd_form.password(class='form-control') }}</div>
            <div class="mb-3">{{ pwd_form.password2.label(class='form-label') }}{{ pwd_form.password2(class='form-control') }}</div>
            <button class="btn btn-warning" type="submit">Change Password</button>
          </form>
        </div>
      </div>
    </section>

    <section id="support" class="settings-section">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Contact Support</h5>
          <form method="post">
            {{ support_form.hidden_tag() }}
            <div class="mb-2">{{ support_form.subject.label(class='form-label') }}{{ support_form.subject(class='form-control') }}</div>
            <div class="mb-3">{{ support_form.message.label(class='form-label') }}{{ support_form.message(class='form-control') }}</div>
            <button class="btn btn-secondary" type="submit">Send</button>
          </form>
        </div>
      </div>
    </section>

    <section id="bookings" class="settings-section">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Bookings</h5>
          {% if bookings %}
            <div class="list-group">
              {% for b in bookings %}
                <div class="list-group-item d-flex justify-content-between align-items-start">
                  <div class="me-3">
                    <div class="fw-semibold">{{ b.name }}</div>
                    <div class="text-muted small">{{ b.appointment_datetime.strftime('%Y-%m-%d %H:%M') }}</div>
                    {% if b.notes %}<div class="mt-2">{{ b.notes }}</div>{% endif %}
                    {% if current_user.is_admin and b.user_id %}
                      <div class="text-secondary small mt-1">User ID: {{ b.user_id }}</div>
                    {% endif %}
                  </div>
                  <div class="btn-group btn-group-sm" role="group" aria-label="booking-actions">
                    <a class="btn btn-outline-primary" href="{{ url_for('main.reschedule_booking', booking_id=b.id) }}">Reschedule</a>
                    <form action="{{ url_for('main.cancel_booking', booking_id=b.id) }}" method="post" class="d-inline">
                      <button class="btn btn-danger" type="submit">Cancel</button>
                    </form>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="mb-0 text-muted">No bookings found.</p>
          {% endif %}
        </div>
      </div>
    </section>

    <section id="account" class="settings-section">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Account</h5>
          <p class="text-muted mb-0">Manage account-level settings and preferences.</p>
        </div>
      </div>
    </section>

    <section id="security" class="settings-section">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Security</h5>
          <p class="text-muted mb-0">Security-related options and activity (placeholder).</p>
        </div>
      </div>
    </section>
  </div>
</div>

<script>
// Sidebar active link handling
document.addEventListener('DOMContentLoaded', function(){
  const links = document.querySelectorAll('.settings-sidebar a');
  function setActive(el){
    links.forEach(l=>l.classList.remove('active'));
    el.classList.add('active');
  }
  links.forEach(link=>{
    link.addEventListener('click', function(e){ setActive(e.currentTarget); });
  });
  // set active based on hash
  if(location.hash){
    const target = document.querySelector('.settings-sidebar a[href="'+location.hash+'"]');
    if(target) setActive(target);
  }
});
</script>

{% endblock %}
