{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<h1>Account Settings</h1>

<div class="row">
  <div class="col-md-6">
    <h3>Profile</h3>
    <form method="post">
      {{ settings_form.hidden_tag() }}
      <div class="mb-3">
        {{ settings_form.name.label }}
        {{ settings_form.name(class="form-control") }}
      </div>
      <div class="mb-3">
        {{ settings_form.email.label }}
        {{ settings_form.email(class="form-control") }}
      </div>
      <button class="btn btn-primary" type="submit">Save Settings</button>
    </form>
  </div>

  <div class="col-md-6">
    <h3>Change Password</h3>
    <form method="post">
      {{ pwd_form.hidden_tag() }}
      <div class="mb-3">{{ pwd_form.current_password.label }}{{ pwd_form.current_password(class='form-control') }}</div>
      <div class="mb-3">{{ pwd_form.password.label }}{{ pwd_form.password(class='form-control') }}</div>
      <div class="mb-3">{{ pwd_form.password2.label }}{{ pwd_form.password2(class='form-control') }}</div>
      <button class="btn btn-warning" type="submit">Change Password</button>
    </form>
  </div>
</div>

<hr>

<h3>Contact Support</h3>
<form method="post">
  {{ support_form.hidden_tag() }}
  <div class="mb-3">{{ support_form.subject.label }}{{ support_form.subject(class='form-control') }}</div>
  <div class="mb-3">{{ support_form.message.label }}{{ support_form.message(class='form-control') }}</div>
  <button class="btn btn-secondary" type="submit">Send</button>
</form>

<hr>

<h3>Your Bookings</h3>
{% if bookings %}
  <ul class="list-group">
  {% for b in bookings %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>{{ b.name }}</strong> â€” {{ b.appointment_datetime.strftime('%Y-%m-%d %H:%M') }}
        <div>{{ b.notes }}</div>
      </div>
      <div>
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('main.reschedule_booking', booking_id=b.id) }}">Reschedule</a>
        <form action="{{ url_for('main.cancel_booking', booking_id=b.id) }}" method="post" style="display:inline">
          <button class="btn btn-sm btn-danger" type="submit">Cancel</button>
        </form>
      </div>
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p>You have no bookings.</p>
{% endif %}

<hr>

<h3>Your Energy Tracker Entries</h3>
{% if entries %}
  <ul class="list-group">
  {% for e in entries %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <p>You used <strong>{{ e.kwh }} kWh</strong> on {{ e.entry_date.strftime('%Y-%m-%d') }}</p>
      </div>
      <div>
        <form action="{{ url_for('main.delete_entry', entry_id=e.id) }}" method="post" style="display:inline">
          <button class="btn btn-sm btn-danger" type="submit">Delete</button>
        </form>
      </div>
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p>You have no energy entries.</p>
{% endif %}

{% endblock %}
